### 命令 ###

`pig`
  `-x` 指定运行模式，可选值：`local`与`mapreduce`(default)
  `-e` 包含脚本的字符串，用于执行简短的脚本
  `-dryrun` 只进行宏扩展而不执行脚本
  `-param/-param-file` 参数替换，使用传给命令行或参数文件中定义参数替换脚本文件中的参数
`pig script.pig` 运行脚本文件

### Pig Grunt交互指令  ###

`DUMP <variable>` 打印变量的值/执行语句翻译而来的计划，用于交互环境下调试
`DESCRIBE <variable>` 打印变量的模式
`ILLUSTRAT <script-name>` 展示脚本执行，数据生成的过程
`EXPLAIN <script-name>` 查看计划(Pig翻译而来的MR计划)

### 符号 ###

`{}` 表示包({`bag}`)

### 脚本语法 ###

**关系操作**

|类型|操作|描述|
|--|--|--|
|加载与存储|LOAD ... USING ... AS|从文件系统或其他存储加载数据，存入关系|
||STORE ... INTO ... USING| 将关系进行存储（在批处理模式下会引发计划执行，而是否真正执行和查询优化有关）|
||DUMP|将关系打印到控制台|
|过滤|FILTER ... BY|按条件对关系进行过滤|
||DISTINCT|从关系删除重复的行|
||FOREACH ... GENERATE ... AS|从关系中增加或删除字段，相当于投影操作|
||MAPREDUCE|以一个关系为输入，运行某个MapReduce作业|
||STREAM ... THROUGH|使用外部程序对一个关系进行变换|
||SAMPLE|对一个关系进行随机取样|
|分组与连接|JOIN|连接两个或多个关系|
||COGROUP|对两个或更多关系中的数据进行分组|
||GROUP ... BY ... [PARALLEL]/GROUP ... ALL/ANY|对一个关系中的数据进行分组|
||CROSS|创建两个或两个以上关系的叉乘|
|排序|ORDER ... BY ... [LIMIT]|根据一个或多个字段对关系进行排序|
||LIMIT|将关系的元组个数限定在一定数量内|
|组合和切分|UNION|合并两个或多个关系为一个关系|
||SPLIT|把某个关系切分为两个或多个关系|

**诊断操作**

|操作|描述|
|--|--|
|DESCRIBE|打印关系的模式|
|EXPLAIN|打印逻辑计划和物理计划|
|ILLUSTRAT|使用数据子集显示逻辑计划试运行结果|

**宏和UDF**

|操作|描述|
|--|--|
|REGISTER|在Pig运行环境中注册一个jar文件|
|DEFINE|为宏、UDF、流式脚本或命令规范新建别名|
|IMPORT|把在另一个文件中定义的宏导入脚本|

**命令**

用于操纵Hadoop文件系统的命令：
cat cd copyFromLocal copyToLocal cp fs ls mkdir mv pwd rm rmf

MapReduce工具：

|命令|描述|
|--|--|
|kill|终止一个MR作业|
|exec|在新的Grunt shell中以批处理运行脚本|
|help|显示帮助|
|quit|退出解释器|
|run|在当前Grunt shell中运行脚本|
|set|设置Pig选项和MR作业属性，如`set debug on`开启调试|
|sh|在Grunt中运行shell命令|

**表达式**

|类别|表达式|描述|示例|
|--|--|--|--|
|常量||常量值，各种类型的字面量形式|`1.0` `'a'`|
|字段(位置指定)|`$n`|第n个字段(0为基数)|`$0`|
|字段(名称指定)|`f`|名为`f`的字段|`year`|
|字段(消除歧义)|`r::f`|分组或连接后关系r中的名为f的字段|`A::year`|
|投影|`c.$n`|关系/包/元组c中位置指定的字段|`records.$0`|
||`c.f`|关系/包/元组c中名称指定的字段|`records.year`|
|Map查找|`m#k`|在映射(字典)m中键k对应的值|`items#'Coat'`|
|类型转换|`(t)f`|将字段f转换为类型t|`(int)year`|
|算数|`x + - * / % y`|加/减/乘/除/取模|`$1%$2`|
||`+x -x`|正值，负值|`-$0`|
|条件|`x?y:z`|标准三元运算符|`qty==0?0:1`|
|比较|`x == != y`|等于/不等于|`qty!=0`|
||`x > < y`|大于/小于|`qty>0`|
||`x >= <= y`|大于等于/小于等于|`qty<=0`|
||`x matches y`|正则匹配|`qty matches '[01459]'`|
||`x is null`|空值|`qty is null`|
||`x is not null`|非空值|`qty is not null`|
|布尔型|`x or and y`|逻辑或/与|`qty == 0 or qty == 1`|
||`not x`|逻辑非|`not qty == 0`|
|函数|`fn(f1,f2,...)`|函数调用|`isGood(qty))`|
|平面化|`FLATTEN(f)`|从包和元祖中去除嵌套|`FLATTEN(group)`|

**数据类型**

|类别|数据类型|描述|示例(字面量)|
|--|--|--|--|
|数值|`int`|32位有符号整数|`1`|
||`long`|64位有符号整数|`1L`|
||`float`|32位浮点数|`1.0F`|
||`double`|64位浮点数|`1.0`|
|文本|`chararray`|UTF-16格式的字符数组|`'a'`|
|二进制|`bytearray`|字节数组|无字面量|
|复杂类型|`tuple`|任意类型字段序列|`{1,'pomegranate'}`|
||`bag`|元组的无序多重集合（允许重复元组）|`{(1,'pomegranate'),(2)}`|
||`map`|键值对集合，键为字符数组，值可以是任意类型|`['a'#'pomegranate']`|

**内置函数**

|类别|数据类型|描述|
|--|--|--|
|计算|AVG|计算包中项的平均值|
||CONCAT|把两个字节数组或字符数组连成一个|
||COUNT|计算一个包中非空值的项的个数|
||COUNT_STAR|计算一个包项的个数，包括空值|
||DIFF|计算两个包的差，如果参数不是包，在类型相同时返回包含这两个参数的包，否则返回空包|
||MAX|计算包中项的最大值|
||MIN|计算包中项的最小值|
||SIZE|计算类型大小，数值型为1，字符数组/字节数组为元素个数，容器类型（如元组）为项个数|
||SUM|计算包中项的值的和|
||TOBAG|把一个或多个表达式转为单独的元组，然后将这些元组放入包中|
||AVG|计算包中项的平均值|
||TOKENIZE|对一个字符数组进行标记解析，将结果放入包|
||TOMAP|将偶数个表达式转换为一个元组|
||TOP|计算包中最前面n个元组|
||TOTUPLE|将一个或多个表达式转为一个元组|
|过滤|IsEmpty|判断一个BAG或MAP是否为空|
|加载/存储|PigStorage|用字段分隔的文本加载或存储关系|
||TextLoader|从纯文本格式加载一个关系。每一行对应于一个元组|
||JsonLoader,JsonStorage|将关系存储到JSON/由JSON加载关系，每个关系为文本中的一行|
||HBaseStroage|在HBase表中加载或存储关系|

**宏**

`$Name` 引用宏参数和返回名使用
`IMPORT './file.macro'` 宏导入


**约定**
语句以分号结束（脚本中要求，Grunt交互模式不要求）
单行注释 `--` 多行注释 `/* ... */`
操作与命令大小写无关，函数名及别名大小写敏感
